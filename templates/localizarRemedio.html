{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localizar {{ item.nome_item }}</title>
    <link rel="stylesheet" href="{% static 'css/localizarRemedio.css' %}">
</head>

<body>

<header>
    <div class="logo">
        <a href="{% url 'home' %}">
            <img src="{% static 'img/Logo_pequena.png' %}" alt="Busca Pharma"/>
        </a>
    </div>
    <nav>
        <ul>
            <li><a href="{% url 'home' %}">Home</a></li>
        </ul>
    </nav>
    <div class="auth-buttons">
        <button class="register-btn"><a href="{% url 'cadastro' %}">Cadastrar-se</a></button>
        <button class="login-btn"><a href="{% url 'login' %}">Entrar</a></button>
    </div>
</header>

<!-- Mapa embutido -->
<div class="Mapa">
    <iframe id="map-frame" src="https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=default_location" 
            frameborder="2" allowfullscreen></iframe>
</div>

<!-- Seção de farmácias -->
<section class="farmacias">
    <h2>Disponibilidade de {{ item.nome_item }}</h2>
    <ul>
        {% for unidade_info in unidades_com_quantidade %}
            <li>
                <a href="javascript:void(0);" onclick="updateMap('{{ unidade_info.cep }}')">
                    <span class="{% if unidade_info.status == 'Aberto' %}status-aberto{% elif unidade_info.status == 'Fechado' %}status-fechado{% endif %}">
                        {{ unidade_info.unidade.nome }} - Quantidade: {{ unidade_info.quantidade_atual }} - CEP: {{ unidade_info.cep }} - Status: {{ unidade_info.status }}
                    </span>
                </a>
            </li>
        {% empty %}
            <li>Nenhuma unidade disponível para este item no momento.</li>
        {% endfor %}
    </ul>
</section>

<script>
    function updateMap(cep) {
        const iframe = document.getElementById('map-frame');
        iframe.src = `https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=${cep}`;
    }
    
    // Função para adicionar um marcador
    function addMarker(lat, lng, nome, quantidade,status) {
        const marker = new google.maps.Marker({
            position: { lat: lat, lng: lng },
            map: map,
            title: nome, // Nome da farmácia
        });

        // Cria uma info window para exibir o nome e a quantidade
        const infoWindow = new google.maps.InfoWindow({
            content: `<h2>${nome}</h2><h3>Quantidade disponível: ${quantidade}</h3><h3>Status: ${status}</h3><a>Agendar</a>`,
        });

        // Adiciona o evento de clique ao marcador para centralizar o mapa e abrir a info window
        marker.addListener('click', function() {
            map.setCenter(marker.getPosition());
            map.setZoom(16);
            infoWindow.open(map, marker);
        });

        markers.push(marker);
    }

    // Função para centralizar o mapa em um marcador específico
    function focusOnMarker(lat, lng, nome) {
        const position = new google.maps.LatLng(lat, lng);
        map.setCenter(position);
        map.setZoom(16);
    }

    // Chama a função de inicialização quando a página carrega
    window.onload = initMap;
</script>
</body>

</html>
